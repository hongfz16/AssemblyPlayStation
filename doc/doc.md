# 汇编大作业文档

## 作业目标
我们的选题为操作系统，这是一个非常有挑战性的任务，因为我们常见的操作系统中只有极少量的代码为汇编，大部分的逻辑实现是通过C语言，因此从时间与精力的角度考虑，纯粹使用汇编语言写一个功能完整的操作系统是不现实的；经过我组成员的讨论，我们该大作业的目标如下：

1. Boot部分需要完整实现，该部分包括但不限于从16-bits模式跳转为32-bits模式，加载全局描述符表，将操作系统内核代码从硬盘载入到内存中，跳转到系统初始化代码
2. 系统初始化部分，仅实现部分必要功能，包括但不限于初始化中断向量表，初始化时钟中断与键盘中断
3. 提供必要的系统API，包括但不限于从缓冲区读入键盘输入`getchar`，在VGA文字模式下输出字符，通过`cmos`芯片获取时间，生成伪随机数，字符串与数字的相互转化
4. 在上述工作的基础上提供几个小程序，包括查看时间的程序，一个简易的跑酷游戏，秒表程序

## 使用说明
- 如果使用我们提供的预编译的可执行文件，请执行如下命令来运行我们的操作系统`qemu-system-i386 -fda os-image-debug.bin`
- 如果希望自行编译，首先请修改`Makefile`中`LD`与`NASM`为自己系统中的路径，接着执行`make run-debug`命令
- 如果希望调试我们的代码，请修改`Makefile`中的`GDB`为自己系统中`gdb`所在路径，接着执行`make debug`
- 进入系统后，首先看到的是菜单栏，按`W`与`S`键来选择所需运行程序，按`J`键进入所需程序，在每个程序的上方都会有该程序的使用说明，请按照说明来使用我们的系统

## 开发环境
- 系统：Ubuntu16.04
- 链接器版本：GNU ld (GNU Binutils) 2.30
- 汇编器版本：NASM version 2.13.03

## 实现原理
### Boot部分

### 系统初始化

### 必要的API

### 三个简单的小程序
#### 显示时间
#### 计时器
#### 恐龙小游戏
该游戏模仿了Chrome的内嵌恐龙跑酷小游戏。实现代码在`dinasour.asm`中。

**游戏规则**：进入游戏后，按`J`跳跃躲避障碍，如果躲避障碍失败则游戏结束，此时按`R`重新开始游戏。游戏中按`P`可以暂停或继续游戏。按`Q`可以退出游戏返回主菜单。

**游戏实现**：由于之前已经实现好了键盘中断和时钟中断，所以键盘操作函数（处理玩家输入事件）注册到键盘中断回调函数中，将游戏画面绘制和状态更新函数注册到时钟中断回调函数中，这样游戏就有了逻辑框架：在键盘回调函数中处理“跳跃”、“暂停”等时间，在时钟回调函数中处理更新“恐龙”，“障碍”等元素的位置，并检测碰撞，在显示器上绘制出最新的游戏画面。此外，调用之前实现好了的随机数生成函数，可以实现随机间隔地生成障碍，增加了游戏的趣味性。

## 难点及创新点

## 组内分工
- 洪方舟：Boot部分、系统API
- 李仁杰：系统初始化
- 王泽宇：三个应用程序

## 参考资料
- [OS Tutorial](https://github.com/cfenollosa/os-tutorial)
- [os-dev.pdf](http://www.cs.bham.ac.uk/~exr/lectures/opsys/10_11/lectures/os-dev.pdf)
- [OSDev Wiki](https://wiki.osdev.org/Main_Page)